<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>个人信息</title>
  <{include file="common_css.html"}>
  <style>
    input.error {
      border: 1px solid red;
    }
    label.error {
      padding-left: 12px;
      padding-bottom: 2px;
      font-weight: bold;
      font-size:12px;
      color: red;
    }
    #pwdTip{padding-left: 12px;
      padding-bottom: 2px;
      font-weight: bold;
      font-size:12px;
      color: red;}
  </style>
</head>
<body>
  <div class="container-fluid">
    <{include file="header.html"}>
    <div class="row" style="min-height:300px">
      <div class="col-md-6 col-md-offset-4">
        <p>用户名:<{$user->username}></p>
        <p>手机:<{$user->telephone}></p>
        <p>地址:<{$user->address}></p>

        <div style="margin-top:30px">
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">修改信息</button>

          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title" id="myModalLabel">信息修改</h4>
                </div>
                <div class="modal-body">
                  <form id="infForm" class="form-horizontal">
                   <div class="form-group">
                    <label for="telephone" class="col-sm-2 control-label">手机:</label>
                    <div class="col-sm-6">
                      <input id="telephone"  name="telephone" type="text" class="form-control" placeholder="手机">
                    </div><div class="col-sm-4"></div>
                  </div>
                  <div class="form-group">
                    <label for="address" class="col-sm-2 control-label">地址:</label>
                    <div class="col-sm-6">
                      <input id="address" type="text" class="form-control" placeholder="地址">
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button id="submitInf" type="button" class="btn btn-primary">确认修改</button>
              </div>
            </div>
          </div>
        </div>
        <button class="btn btn-danger" data-toggle="modal" data-target="#pwdModal">修改密码</button>
        <div class="modal fade" id="pwdModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">密码修改</h4>
              </div>
              <div class="modal-body">
                <form id="pwdForm" class="form-horizontal" method="post" action="<{$root}>user/updatePwd">
                  <div class="form-group">
                    <label for="oldPwd" class="col-sm-3 control-label">旧密码:</label>
                    <div class="col-sm-6">
                      <input id="oldPwd" name="oldPwd" type="password" class="form-control" placeholder="旧密码">
                    </div><div id="pwdTip"  class="col-sm-3"></div>
                  </div>
                  <div class="form-group">
                    <label for="newPwd" class="col-sm-3 control-label">新密码:</label>
                    <div class="col-sm-6">
                      <input id="newPwd" name="newPwd" type="password" class="form-control" placeholder="新密码">
                    </div><div class="col-sm-3"></div>
                  </div>
                  <div class="form-group">
                    <label for="ackPwd" class="col-sm-3 control-label">确认新密码:</label>
                    <div class="col-sm-6">
                      <input id="ackPwd" name="ackPwd" type="password" class="form-control" placeholder="确认新密码">
                    </div>
                    <div class="col-sm-3"></div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" id="submitPwd" class="btn btn-primary">确认修改</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <{include file="footer.html"}>
</div>
<{include file="common_js.html"}>
<script type="text/javascript" src="<{$root}>static/js/jquery.validate.js"></script>
<script type="text/javascript" src="<{$root}>static/js/messages_zh.js"></script>
<script>
var root = getRootPath();
$(function(){
  $("#submitInf").click(function(){
    $.ajax({
      url : root + "/user/updateInf",
      data : {
        telephone : $("#telephone").val(),
        address : $("#address").val()
      },
      type : 'post',
      dataType : 'html',
      success : function(data){
        alert("修改成功！");
        window.location.href = root + "/user/userDetail";
      },
      error : function(){
        alert("异常");
      }
    })
  });

  $("#infForm").validate({
    rules:{
      telephone : {
        digits : true,
        maxlength : 13
      }
    },
    errorPlacement:function(error,element) {
      error.appendTo(element.parent("div").next("div"));
    },
  });

  $("#pwdForm").validate({
    rules:{
      oldPwd :{
        required : true
      },
      newPwd : {
        required : true,
        minlength : 6
      },
      ackPwd : {
        required : true,
        minlength : 6,
        equalTo : "#newPwd"
      },
    },
    submitHandler: function(form) {
      $.ajax({
        url : root + "/user/updatePwd",
        data : {
          oldPwd : $("#oldPwd").val(),
          newPwd : $("#newPwd").val()
        },
        type : "post",
        dataType : "html",
        success : function(data) {
          if(data) {
            alert("修改成功");
            window.location.href = root +"/user/logout";
          }
          else {
            $("#pwdTip").html("密码错误");
          }
        },
        error : function(){
          alert("异常");
        }
      })
    },
    errorPlacement:function(error,element) {
      error.appendTo(element.parent("div").next("div"));
    },
  });

  $("#submitPwd").click(function(){
    $("#pwdForm").submit();
  });
})
</script>
</body>
</html>